<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link
	href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Gowun+Dodum&family=IBM+Plex+Sans+KR&display=swap"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<title>Insert title here</title>
<style type="text/css">
div.hello {
	position: absolute;
	border: 1px solid gray;
	font-family: Gowun Dodum;
	font-size: 1.5em;
}

div.hlist {
	position: absolute;
	font-family: Gowun Dodum;
	font-size: 15pt;
}

div.button {
	left: 100px;
	top: 70px;
	width: 500px;
	height: 110px;
	line-height: 100px;
	text-align: center;
}

div.addform, div.updateForm {
	left: 100px;
	top: 200px;
	width: 500px;
	height: 450px;
	padding: 20px 20px;
}

img.avata {
	cursor: pointer;
}

img.select {
	border: 2px solid green;
}

div.list {
	left: 700px;
	top: 50px;
	width: 600px;
	height: 1000px;
	padding: 20px;
}

span.writer {
	font-weight: bold;
}

span.day {
	color: #bbb;
	float: right;
}

pre.cont {
	font-family: 'Gowun Dodum';
	font-size: 18px;
}

i.bi {
	margin-left: 10px;
	float: right;
	cursor: pointer;
}
</style>

<script type="text/javascript">
	$(function() {

		list();

		$("div.addform").hide();
		$("div.updateForm").hide();

		$("#btnadd").click(function() {
			$("div.updateForm").hide();
			$("div.addform").slideToggle('slow');
		})

		$("img.avata").eq(2).addClass("select");

		$("#avata").val($("img.avata").eq(2).attr("src"))

		//아바타선택시  값 변경
		$("img.avata").click(function() {
			$(this).siblings().removeClass("select");
			$(this).addClass("select");
			$("#avata").val($(this).attr("src"));
		})

		//추가 폼 저장
		$("#dbsave").click(function() {
			var data = $("#addfrm").serialize();

			$.ajax({
				type : "post",
				dataType : "html",
				url : "worldInsert.jsp",
				data : data,
				success : function() {
					list();
					//입력값 초기화
					$("#writer").val("");
					$("#content").val("");

					//아바타 초기화
					$("img.avata").eq(2).addClass("select");
					$("#avata").val($("img.avata").eq(2).attr("src"));
					$("img.avata").removeClass("select");

				}
			});
		});
		
		
		
		
		
	//목록의 삭제 버튼
	$(document).on("click", "i.bi-x-circle", function() {
			var num = $(this).attr("num");
			/* alert(num); */
			$.ajax({
				type : "get",
				dataType : "html",
				url : "worldDelete.jsp",
				data:{"num":num},
				success : function() {
					list();

				}
			});

		});
	
	//목록의 수정 버튼
	$(document).on("click", "i.bi-cloud-upload", function() {
		var num = $(this).attr("num");
		//alert(num);
		//폼의 unum에 num넣기
		$("#num").val(num);
		 $.ajax({
			type : "get",
			dataType : "json",
			url : "worldGetData.jsp",
			data:{"num":num},
			success : function(res) {
				
				//수정폼 태그안에 넣어준다
				$("#num").val(res.num);
				$("#uwriter").val(res.writer);
				$("#ucontent").val(res.content);
				$("#uavata").val(res.avata);
				
				//해당이미지에 select클래스 추가
				$("img.uavata").each(function (i,ele) {
					
					if($(this).attr("src")==res.avata){
						$(this).addClass("select");
					}else{
						$(this).removeClass("select");
					}
					
				});
				
				//추가 폼이 있음 숨기고 수정폼으로 나타낸다
				$("div.addform").hide();
				$("div.updateForm").show();
				
				$("img.uavata").click(function() {
					$(this).siblings().removeClass("select");
					$(this).addClass("select");
					$("#uavata").val($(this).attr("src"));
				})

			}
		});

	});
	
	//수정 폼 저장
    $("#dbUpdate").click(function(){
       
       var s=$("#updatefrm").serialize();
       alert(s);
      $.ajax({
          type:"post",
          url:"worldUpdate.jsp",
          dataType:"html",
          data:s,
          success:function(){
        	  
             
             //추가 성공시 목록 다시 출력
             list();
             //입력값 초기화
             $("#uwriter").val("");
             $("#ucontent").val("");
             
             $("img.uavata").removeClass("select");
             $("img.uavata").eq(2).addClass("select");
             var imgSrc=$("img.uavata").eq(2).attr("src");
             $("#uavata").val(imgSrc);
          }
       })
       
    })   
	
	});

	//사용자 함수 list
	function list() {
		$.ajax({
					type : "get",
					dataType : "json",
					url : "worldList.jsp",
					success : function(data) {

						//alert(data.length);
						var s = "";

						if (data.length == 0) {
							s += "<h3 class='alert alert-info'>저장된 방명록이 없습니다</h3>";
						} else {
							s += "<h2>방명록 목록</h2>"
							$
									.each(
											data,
											function(i, elt) {
												s += "<i class='bi bi-x-circle' num="+elt.num+"></i>";
												s += "<i class='bi bi-cloud-upload' num="+elt.num+"></i>";
												s += "<table class='table table-bordered'>";
												s += "<tr><td>";
												s += "<span class='writer'>작성자: "
														+ elt.writer
														+ "</span>";
												s += "<span class='day'>"
														+ elt.writeday
														+ "</span>";
												s += "<br>";
												s += "<pre class='cont' style='font-family:Gowun Dodum;'>"
														+ elt.content;
												s += "<img src='"+elt.avata+"' align='right' width='80'>";
												s += "</pre></td></tr>";

												s += "</table><br>";

											})
						}

						$("div.list").html(s);
					}
				})
	}
</script>
</head>
<body>
	<div class="hello button">
		<button type="button" class="btn btn-dark" id="btnadd"
			style="width: 120px;">방명록 추가</button>
	</div>

	<div class="hello addform">
		<form id="addfrm">
			<table class="table table-bordered">
				<caption align="top">
					<h2>방명록 추가</h2>
				</caption>
				<tr>
					<th width="120" valign="middle">작성자</th>
					<td><input type="text" class="form-control input-sm"
						name="writer" id="writer" style="width: 120px;"></td>
				</tr>
				<tr>
					<th width="120" align="center">남기는 말</th>
					<td><textarea style="width: 300px; height: 100px"
							class="form-control" name="content" id="content"></textarea></td>
				</tr>
				<tr>
					<th width="120" align="center">아바타</th>
					<td><input type="hidden" name="avata" id="avata"> <script
							type="text/javascript">
						var s = "";
						for (var i = 1; i <= 10; i++) {
							s += "<img src='../image/avata/b"+i+".png' width='50' class='avata'>";

							if (i == 5) {
								s += "<br>";
							}
						}

						document.write(s);
					</script></td>
				</tr>

				<tr>
					<td colspan="2" align="center">
						<button type="button" class="btn btn-success" id="dbsave">DB저장하기</button>
					</td>
				</tr>

			</table>
		</form>
	</div>

	<div class="hello updateForm">
	<form id="updatefrm">
	<input type="hidden" id="unum" name="unum">
			<table class="table table-bordered">
				<caption align="top">
					<h2>방명록 수정</h2>
				</caption>
				<tr>
					<th width="120" valign="middle">작성자</th>
					<td><input type="text" class="form-control input-sm"
						name="uwriter" id="uwriter" style="width: 120px;"></td>
				</tr>
				<tr>
					<th width="120" align="center">남기는 말</th>
					<td><textarea style="width: 300px; height: 100px"
							class="form-control" name="ucontent" id="ucontent"></textarea></td>
				</tr>
				<tr>
					<th width="120" align="center">아바타</th>
					<td><input type="hidden" name="uavata" id="uavata"> <script
							type="text/javascript">
						var s = "";
						for (var i = 1; i <= 10; i++) {
							s += "<img src='../image/avata/b"+i+".png' width='50' class='uavata'>";

							if (i == 5) {
								s += "<br>";
							}
						}

						document.write(s);
					</script></td>
				</tr>

				<tr>
					<td colspan="2" align="center">
						<button type="button" class="btn btn-success" id="dbUpdate">DB수정하기</button>
					</td>
				</tr>

			</table>
		</form>
	</div>
	<div class="hlist list"></div>

</body>
</html>